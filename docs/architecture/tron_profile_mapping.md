# TRON プロファイル別ユースケースと API マッピング

## 1. ターゲットごとのユースケースと必須機能

### ラップトップ
- **ユースケース**: 産業向けエッジ開発端末、TRON ネイティブアプリの動作検証、開発者向けデバッグ・計測。
- **必須機能**:
  - SMP を活用した複数コンパイルジョブ/ビルドの並列化。
  - POSIX/IEEE2050 共通 API を通じた既存ツール群の移植性確保。
  - GUI/ウィンドウシステム連携、USB 入出力、ストレージファイルシステム。
  - ネットワークスタックの TLS/SSH 対応、安全なリモート管理。

### スマートフォン
- **ユースケース**: 組込み向けリファレンス端末、IoT ゲートウェイ、UI リッチな制御パネル。
- **必須機能**:
  - 低消費電力の動的電源管理、センサー I/O、タッチ UI フレームワーク。
  - µT-Kernel 3.0/DSMP による省メモリ RTOS プロファイル運用。
  - IEEE2050 API でのポータブルアプリ提供、アプリサンドボックス化。
  - セキュアブート／アプリ署名、無線通信（Wi-Fi/BLE/LTE）セキュリティ。

### ロボット
- **ユースケース**: 産業用ロボットコントローラ、AMR（自律移動ロボット）、遠隔操作機。
- **必須機能**:
  - ハードリアルタイム制御（サーボ周期 1ms 以下）、マルチコア協調制御。
  - T-Kernel 2.0 SMP 拡張による大規模タスク制御と負荷分散。
  - 硬直なデバイスドライバ管理、フィールドバス通信（EtherCAT など）。
  - 安全機能（緊急停止、フェイルセーフ）、ロギングとトレース。

## 2. プロファイル別 API マッピング

| 機能領域 | ラップトップ | スマートフォン | ロボット |
| --- | --- | --- | --- |
| マルチコアスケジューリング | T-Kernel 2.0 SMP 拡張 | µT-Kernel 3.0（マルチコアサポートオプション） | T-Kernel 2.0 SMP 拡張 |
| 省メモリ RTOS | （補助的利用: µT-Kernel 3.0/DSMP による周辺制御） | µT-Kernel 3.0/DSMP | µT-Kernel 3.0（サブコントローラ） |
| 共通ユーザ API | IEEE2050 共通 API | IEEE2050 共通 API | IEEE2050 共通 API |
| セキュリティ/暗号 | T-Kernel + IEEE2050 セキュリティ拡張 | µT-Kernel セキュリティプロファイル + IEEE2050 | T-Kernel セーフティ拡張 |
| デバイスドライバ | T-Kernel デバイスマネージャ | µT-Kernel I/O マネージャ | T-Kernel デバイスマネージャ |
| UI フレームワーク | IEEE2050 GUI API + T-Kernel ウィンドウシステム | µT-Kernel UI フレームワーク + IEEE2050 | 外部 HMI（IEEE2050） + T-Kernel リアルタイム制御 |
| ネットワーク | IEEE2050 ネットワークスタック | IEEE2050 ネットワークスタック | IEEE2050 ネットワークスタック + フィールドバス拡張 |

## 3. Rust 実装スタブ API の現状とバックログ

### 実装済みスタブ
現在 `src/main.rs` には以下の TRON API スタブが実装済みです。

| API 名 | 役割 | 現状 |
| --- | --- | --- |
| `tk_cre_tsk` | タスク生成 | スタブ実装（固定 ID 1 を返す） |
| `tk_sta_tsk` | タスク開始 | スタブ実装（常に成功コード 0 を返す） |
| `tk_slp_tsk` | タスクスリープ | スタブ実装（常に成功コード 0 を返す） |

### 未実装だが必須となる API
ラップトップ／スマートフォン／ロボットの各プロファイルで最低限必要になる API を下表に整理します。

| 優先度 | API/機能 | 依存関係 | 想定スプリント | 備考 |
| --- | --- | --- | --- | --- |
| 高 | `tk_del_tsk`（タスク削除） | `tk_cre_tsk` 完全実装 | Sprint 1 | タスクライフサイクル管理に必須 |
| 高 | `tk_wup_tsk` / `tk_slp_tsk` 拡張 | タスク状態管理 | Sprint 1 | スマホ/ロボットの同期制御で必要 |
| 高 | `tk_dly_tsk`（遅延） | システムタイマ | Sprint 1 | ロボット周期制御の基盤 |
| 高 | `tk_sta_tsk` 実体化 | タスクコンテキストスイッチャ | Sprint 2 | 現在はスタブ、実動コード化が必要 |
| 中 | `tk_cre_sem` / `tk_wai_sem` | カーネル同期プリミティブ | Sprint 2 | マルチタスク同期（SMP 対応） |
| 中 | `tk_ref_tsk`（タスク参照） | タスク管理テーブル | Sprint 2 | デバッグ・UI 監視用 |
| 中 | タイマ管理 (`tk_cre_tmr`, `tk_sta_tmr`) | ハードウェアタイマ | Sprint 3 | 省電力/リアルタイム制御 |
| 中 | デバイスドライバ登録 API | デバイスマネージャ | Sprint 3 | ロボット/スマホのI/O拡張 |
| 低 | メモリ管理 (`tk_get_mpl`, `tk_rel_mpl`) | メモリプール実装 | Sprint 4 | 大規模アプリ用 |
| 低 | IEEE2050 共通 API バインディング | 基本 TRON API | Sprint 4 | クロスプラットフォーム支援 |

## 4. プロファイル固有の追加要件

- **ラップトップ**: デスクトップ統合 UI（Wayland/X11 ブリッジ）、ハードウェアアクセラレーション、開発者用の完全な POSIX 互換層、フルディスク暗号化、リモートデバッグ（GDB/Rust-analyzer）用デーモン。
- **スマートフォン**: セキュアエンクレーブ連携、アプリケーションサンドボックス、マルチテナント用のリソース制限、OTA アップデートの検証、バッテリーセーフガード。
- **ロボット**: デターミニスティックなスケジューリング検証ツール、冗長センサーフュージョン、産業安全規格（ISO 10218/13849）準拠ログ、フィールドバス（EtherCAT/CANopen）対応。

## 5. レビューと公開

本ドキュメントは関係者レビュー用に Pull Request として公開されます。レビューでは各ターゲットの追加要件・API 優先度の妥当性を確認し、今後のスプリント計画に反映します。
